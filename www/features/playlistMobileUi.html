<!DOCTYPE html>
<html>
  <head>
  <title>Playlist mobile ui</title>
  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
	<meta charset="utf-8">
	<script type="text/javascript" charset="utf-8" src="../lib/phonegap/phonegap.js"></script>  
	<link rel="stylesheet" href="../css/kmf-docs.css" />
	<script src="../lib/jquery/jquery.min.js"></script>
    <script src="../lib/jquery/jquery.mobile.min.js"></script>
    <link rel="stylesheet" href="../lib/jquery/jquery.mobile.min.css" />
    <script src="http://cdnbakmi.kaltura.com/html5/html5lib/v1.6.6/mwEmbedLoader.php"><</script>
    
    <script>
        $( document ).bind( "mobileinit", function() {
            // Make your jQuery Mobile framework configuration changes here!
            $.mobile.allowCrossDomainPages = true;
            $.mobile.page.addBackBtn = true;
        });
    </script>
  </head>
  <body>
  
  <script> 
  	var getPlaylistRequestUrl = function( wid, playlistId ){
  		return 'http://www.kaltura.com/api_v3/index.php?service=multirequest&format=9' +
  				'&callback=?&1:service=session&1:action=startWidgetSession&1:widgetId=' + 
  				wid + '&2:service=playlist&2:action=execute&2:ks={1:result:ks}&2:id=' + 
  				playlistId;
  	};
  	
  	$('#playlistConfig').live('pagecreate', function(){
		$('#buildPlaylist').click(function(){
			console.log( 'buildPlaylist ');
			$( this ).fadeOut('fast');
			// set the page to loading:
			$.mobile.showPageLoadingMsg();
		
			$('#configurePlaylist').fadeOut('fast');
			var widgetId = '_' + $('#partnerId').val();
			var playlistId = $('#playlistId').val();  
			$.getJSON( getPlaylistRequestUrl(widgetId, playlistId), function(data){
				var plList = data[1];
				$ulTarget = $('#playlistContainer ul');
				$.each( plList, function( inx, clip ){
					$ulTarget.append( 
							$('<li />').append( 
								$('<a />').attr('href', '#').append(
									$('<img />').attr('src', clip.thumbnailUrl ),
									$('<h3 />').text( clip.name ),
									$('<p />').text( clip.description )
								)
							)
					)					
				});
				$.mobile.hidePageLoadingMsg();
				//debugger;
				$ulTarget.listview("refresh");
				
				
			})
		});  		
  	});
  </script>
  
  <div id="playlistConfig" data-role="page" class="type-home" data-theme="b">
	  	<div data-role="header" data-add-back-btn="true" data-theme="b">
	  	
	  	<a href="../index.html" data-add-back-btn="true">Back</a>
			<h1>Playlist mobile ui</h1>
		</div>
		<div id="configurePlaylist">
			<div data-role="fieldcontain" class="ui-field-contain ui-body ui-br">
		        <label for="name-a" class="ui-input-text">Partner id:</label>
		        <input id="partnerId" value="243342" type="text" value="" id="name-a" name="name" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset">
			</div>
		
			<div data-role="fieldcontain" class="ui-field-contain ui-body ui-br">
		        <label for="name-a" class="ui-input-text">Playlist id:</label>
		        <input id="playlistId" value="0_q79jh71b" type="text" value="0_q79jh71b" id="name-a" name="name" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset">
			</div>
			
			<div data-role="fieldcontain" class="ui-field-contain ui-body ui-br">
				<label for="slider-a" class="ui-input-text ui-slider" id="slider-a-label">Thumbnail size:</label>
			 	<input type="number" data-type="range" max="100" min="0" value="40" id="slider-a" name="slider" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset ui-slider-input">
			</div>
		</div>
				<a id="buildPlaylist" style="width:150px;" href="#" data-role="button">Build playlist</a> 
				
		<div id="playlistContainer">
			<ul data-role="listview" class="ui-listview">
				
			</ul>
		</div>
		
	</div>



  </body>
</html>